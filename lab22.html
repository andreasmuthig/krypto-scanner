<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trend‑Scanner mit Score-LED</title>
  <style>
    body { background-color: #121212; color: #e0e0e0; font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    #navMenu { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(53,53,53,0.95); box-shadow: 0 4px 20px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1100; }
    #navMenu .menu-item { margin: 0 15px; display: flex; align-items: center; gap: 5px; font-size: 16px; }
    #navMenu .menu-item a { color: #e0e0e0; text-decoration: none; padding: 5px 10px; border-radius: 5px; transition: all 0.3s ease; }
    #navMenu .menu-item:hover a { text-shadow: 0 0 5px #666; }
    #mainContent { margin-top: 100px; }
    #controls { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
    select, button { background: #222; color: #e0e0e0; border: 1px solid #444; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    #chartContainer { position: relative; height: 300px; margin-bottom: 20px; }
    #stats, #analysis { margin-bottom: 10px; }
    #analysis { background: #1e1e1e; padding: 10px; border-radius: 5px; font-size: 14px; line-height: 1.4; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border: 1px solid #444; text-align: center; }
    th { background: #333; }
    .led-bar { display: flex; justify-content: center; gap: 4px; }
    .led { width: 14px; height: 10px; border-radius: 2px; background: #444; box-shadow: inset 0 0 4px #000; }
    .on-red { background: #b00020; box-shadow: 0 0 6px #ff3d3d; }
    .on-orange { background: #ff9100; box-shadow: 0 0 6px #ff9100; }
    .on-yellow { background: #ffea00; box-shadow: 0 0 6px #ffea00; }
    .on-green { background: #00c853; box-shadow: 0 0 6px #00e676; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.2.2/dist/chartjs-plugin-annotation.min.js"></script>
  <script src="https://unpkg.com/simple-statistics@7.7.4/dist/simple-statistics.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
  <nav id="navMenu">
    <div class="menu-item"><a href="index.html"><i data-feather="home"></i> Home</a></div>
    <div class="menu-item"><a href="lab20.html"><i data-feather="activity"></i> Monitor</a></div>
    <div class="menu-item"><a href="settings.html"><i data-feather="settings"></i> Einstellungen</a></div>
    <div class="menu-item"><a href="#scanner"><i data-feather="trending-up"></i> Scannen</a></div>
  </nav>

  <div id="mainContent">
    <section id="scanner">
      <div id="controls">
        <label for="symbol">Coin:</label>
        <select id="symbol"><option>BTCUSDT</option><option>ETHUSDT</option><option>SOLUSDT</option></select>
        <label for="interval">Zeitrahmen:</label>
        <select id="interval"><option value="1h">1 Stunde</option><option value="4h">4 Stunden</option><option value="1d">1 Tag</option></select>
        <button id="btnScan">Scan starten</button>
      </div>
      <div id="chartContainer"><canvas id="trendChart"></canvas></div>
      <div id="stats"></div>
      <div id="analysis"></div>
      <table id="resultTable"><thead><tr><th>Signal</th><th>Preis</th><th>Trendlinie</th><th>Score</th><th>SL</th><th>TP</th></tr></thead><tbody></tbody></table>
    </section>
  </div>

  <script>
    feather.replace();
    let chart = null;
    const ctx = document.getElementById('trendChart').getContext('2d');
    const higherTF = { '1h':'4h', '4h':'1d', '1d':'4h' };

    function scoreBar(score) {
      const val = parseInt(score);
      let active = 0;
      if (val >= 80) active = 5;
      else if (val >= 60) active = 4;
      else if (val >= 40) active = 3;
      else if (val >= 20) active = 2;
      else if (val > 0) active = 1;
      let leds = '';
      for (let i = 0; i < 5; i++) {
        let cls = 'led';
        if (i < active) {
          cls += val >= 80 ? ' on-green' : val >= 60 ? ' on-yellow' : val >= 40 ? ' on-orange' : ' on-red';
        }
        leds += `<div class="${cls}"></div>`;
      }
      return `<div class="led-bar">${leds}</div>`;
    }

    // ... scan() Funktion bleibt unverändert ... nur Ausgabe anpassen:

    document.getElementById('btnScan').addEventListener('click', scan);
    document.getElementById('symbol').addEventListener('change', scan);
    document.getElementById('interval').addEventListener('change', scan);
    window.addEventListener('load', scan);

    async function scan() {
      try {
        // ... alle bisherigen Berechnungen (aus vorherigem Code) ...

        // Am Ende die Tabelle erzeugen mit Score-Balken:
        document.querySelector('#resultTable tbody').innerHTML = `
          <tr>
            <td>${signal}</td>
            <td>${priceLast.toFixed(2)}</td>
            <td>${trend.at(-1).toFixed(2)}</td>
            <td>${scoreBar(score)}</td>
            <td>${sl.toFixed(2)}</td>
            <td>${tp.toFixed(2)}</td>
          </tr>`;

      } catch (err) {
        console.error("Scan-Fehler:", err);
        alert("Beim Scannen ist ein Fehler aufgetreten.");
      }
    }
  </script>
</body>
</html>