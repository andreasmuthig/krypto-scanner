<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Coin Analyse mit LEDs</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .left {
      flex: 0 0 30%;
      background: #2f3530;
      border-radius: 10px;
      padding: 20px;
    }
    .right {
      flex: 0 0 70%;
      background: #2f3530;
      border-radius: 10px;
      padding: 20px;
    }
    .indicator {
      margin-bottom: 20px;
    }
    .label {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .led-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }
    .led {
      width: 20px;
      height: 20px;
      background: #444;
      border-radius: 4px;
    }
    .led.on {
      background: #00c67a;
    }
    .score-text {
      font-size: 0.9em;
      color: #aaa;
    }
    pre {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      color: #ccf;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Analyse: BTCUSDT</h1>
  <div class="container">
    <div class="left">
      <div class="indicator" id="ma-section">
        <div class="label">MA 50 / MA 200</div>
        <div class="led-row" id="ma-leds"></div>
        <div class="score-text" id="ma-text">Lade MA-Daten…</div>
      </div>
      <div class="indicator" id="macd-section">
        <div class="label">MACD</div>
        <div class="led-row" id="macd-leds"></div>
        <div class="score-text" id="macd-text">Simulierte MACD-Auswertung…</div>
      </div>
      <div class="indicator" id="rsi-section">
        <div class="label">RSI</div>
        <div class="led-row" id="rsi-leds"></div>
        <div class="score-text" id="rsi-text">Lade RSI-Daten…</div>
      </div>
    </div>
    <div class="right">
      <h2>Beispieltext</h2>
      <pre>
Hier erscheint dynamisch generierter Text, basierend auf der Analyse von MA, MACD und RSI. Die LEDs auf der linken Seite zeigen die aktuelle Bewertung visuell an.
      </pre>
    </div>
  </div>

  <script>
    async function ladeAnalyse() {
      try {
        const res = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=200');
        const data = await res.json();

        const closePrices = data.map(d => parseFloat(d[4]));
        const ma50 = closePrices.slice(-50).reduce((a, b) => a + b, 0) / 50;
        const ma200 = closePrices.reduce((a, b) => a + b, 0) / 200;

        // MA Bewertung
        const abstand = ((ma50 - ma200) / ma200) * 100;
        const maScore = (ma50 > ma200 && abstand > 10) ? 4 : (Math.abs(ma50 - ma200) < 1 ? 1 : 0);
        const maLeds = document.getElementById("ma-leds");
        maLeds.innerHTML = "";
        for (let i = 0; i < 4; i++) {
          const led = document.createElement("div");
          led.className = "led" + (i < maScore ? " on" : "");
          maLeds.appendChild(led);
        }
        document.getElementById("ma-text").textContent = `MA50: ${ma50.toFixed(2)} | MA200: ${ma200.toFixed(2)} | Abstand: ${abstand.toFixed(1)}%`;

        // RSI (simuliert auf Basis der letzten 14 Kerzen)
        const rsiSlice = closePrices.slice(-15);
        let gains = 0, losses = 0;
        for (let i = 1; i < rsiSlice.length; i++) {
          const diff = rsiSlice[i] - rsiSlice[i - 1];
          if (diff > 0) gains += diff;
          else losses -= diff;
        }
        const rs = gains / (losses || 1);
        const rsi = 100 - (100 / (1 + rs));
        const rsiScore = rsi < 25 ? 3 : rsi > 75 ? 0 : 1;
        const rsiLeds = document.getElementById("rsi-leds");
        rsiLeds.innerHTML = "";
        for (let i = 0; i < 3; i++) {
          const led = document.createElement("div");
          led.className = "led" + (i < rsiScore ? " on" : "");
          rsiLeds.appendChild(led);
        }
        document.getElementById("rsi-text").textContent = `RSI: ${rsi.toFixed(2)} (${rsiScore} Punkte)`;

        // MACD (simuliert)
        const macdScore = (Math.random() > 0.7 ? 3 : (Math.random() > 0.5 ? 1 : 0)); // Simulation
        const macdLeds = document.getElementById("macd-leds");
        macdLeds.innerHTML = "";
        for (let i = 0; i < 3; i++) {
          const led = document.createElement("div");
          led.className = "led" + (i < macdScore ? " on" : "");
          macdLeds.appendChild(led);
        }
        document.getElementById("macd-text").textContent = `MACD (simuliert): ${macdScore} Punkte`;

      } catch (e) {
        console.error("Fehler beim Laden der Analyse:", e);
      }
    }

    ladeAnalyse();
  </script>
</body>
</html>
