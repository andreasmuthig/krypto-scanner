<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Coin-Analyse</title>
  <style>
    body { background: #111; color: #eee; font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border-bottom: 1px solid #333; text-align: center; }
    th { background: #222; }
    h1 { text-align: center; }
    .green { color: #4caf50; }
    .red { color: #f44336; }
  </style>
</head>
<body>
  <h1 id="headline">Analyse</h1>
  <table>
    <thead>
      <tr>
        <th>Asset</th>
        <th>Kurs</th>
        <th>Einstieg</th>
        <th>Take-Profit</th>
        <th>Stop-Loss</th>
        <th>Haltezeit</th>
        <th>Empfehlung</th>
      </tr>
    </thead>
    <tbody id="analyseTabelle">
      <tr><td colspan="7">Lade Analyse...</td></tr>
    </tbody>
  </table>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const symbol = urlParams.get("symbol") || "BTCUSDT";
    document.getElementById("headline").textContent = `Analyse: ${symbol}`;

    async function ladeLiveDaten(symbol) {
      const ticker = await fetch("https://api.binance.com/api/v3/ticker/24hr").then(r => r.json());
      const eintrag = ticker.find(d => d.symbol === symbol);
      return {
        symbol,
        preis: parseFloat(eintrag.lastPrice),
        change24h: parseFloat(eintrag.priceChangePercent),
        volume: parseFloat(eintrag.quoteVolume)
      };
    }

    async function holeAnalyse() {
      try {
        const daten = await ladeLiveDaten(symbol);
        const res = await fetch("http://localhost:3001/api/analyse", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(daten)
        });
        const analyse = await res.json();

        document.getElementById("analyseTabelle").innerHTML = `
          <tr>
            <td>${symbol}</td>
            <td>${daten.preis.toFixed(2)}</td>
            <td>${analyse.entry}</td>
            <td>${analyse.tp1} / ${analyse.tp2}</td>
            <td>${analyse.sl}</td>
            <td>${analyse.hold}</td>
            <td><strong>${analyse.recommendation}</strong></td>
          </tr>`;
      } catch (err) {
        document.getElementById("analyseTabelle").innerHTML = `<tr><td colspan="7">Fehler: ${err.message}</td></tr>`;
      }
    }

    holeAnalyse();
  </script>
</body>
</html>
