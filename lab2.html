!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Krypto Scanner</title>
  <style>
    body {
      background-color: #1c1c1c;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 10px;
    }

    h1 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #ccc;
    }

    .asset-block {
      background-color: #2a2a2a;
      border-radius: 8px;
      margin-bottom: 12px;
      padding: 10px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      font-size: 14px;
    }

    .mini-label {
      font-size: 10px;
      color: #888;
      text-align: center;
    }

    .row div {
      flex: 1 1 10%;
      text-align: center;
    }

    .led-bar {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-top: 4px;
    }

    .led {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      background-color: #444;
    }

    .led.active {
      background-color: #00ff88;
    }

    .details {
      display: flex;
      justify-content: space-around;
      margin-top: 8px;
      font-size: 12px;
      color: #aaa;
    }

    .trend-up { color: #00ff88; }
    .trend-down { color: #ff4444; }

    .bold { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Krypto Scanner</h1>
  <div id="container"></div>

  <script>
    const watchlist = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT", "DOTUSDT", "LINKUSDT", "AVAXUSDT"];

    function createLEDs(count) {
      let leds = "";
      for (let i = 0; i < 4; i++) {
        leds += `<div class="led ${i < count ? 'active' : ''}"></div>`;
      }
      return leds;
    }

    function mini(label, value) {
      return \`
        <div>
          <div class="mini-label">\${label}</div>
          <div class="bold">\${value}</div>
        </div>\`;
    }

    async function fetchData(symbol) {
      try {
        const [ticker, klines] = await Promise.all([
          fetch(\`https://api.binance.com/api/v3/ticker/24hr?symbol=\${symbol}\`).then(res => res.json()),
          fetch(\`https://api.binance.com/api/v3/klines?symbol=\${symbol}&interval=1h&limit=50\`).then(res => res.json())
        ]);

        const closePrices = klines.map(k => parseFloat(k[4]));
        const kurs = parseFloat(ticker.lastPrice);
        const change = parseFloat(ticker.priceChangePercent);
        const einstieg = (kurs * 0.995).toFixed(2);
        const tp1 = (kurs * 1.015).toFixed(2);
        const tp2 = (kurs * 1.03).toFixed(2);
        const stop = (kurs * 0.99).toFixed(2);
        const change1h = ((kurs - parseFloat(klines[0][4])) / parseFloat(klines[0][4]) * 100).toFixed(2);

        // RSI
        let gains = 0, losses = 0;
        for (let i = 1; i < closePrices.length; i++) {
          const diff = closePrices[i] - closePrices[i - 1];
          if (diff >= 0) gains += diff;
          else losses -= diff;
        }
        const avgGain = gains / 14;
        const avgLoss = losses / 14;
        const rs = avgGain / avgLoss;
        const rsi = 100 - (100 / (1 + rs));
        const rsiLED = rsi < 25 ? 4 : rsi < 50 ? 3 : rsi < 70 ? 2 : 1;

        // CRV
        const crv = ((tp1 - einstieg) / (einstieg - stop)).toFixed(2);
        const crvLED = Math.min(4, Math.floor(crv));

        // Anzeige
        const row = document.createElement("div");
        row.className = "asset-block";
        row.innerHTML = \`
          <div class="row">
            \${mini("Asset", "<a style='color:#4fc3f7' href='coin.html?symbol=" + symbol + "'>" + symbol + "</a>")}
            \${mini("Kurs", kurs.toFixed(2) + " USDT")}
            \${mini("Einstieg", einstieg)}
            \${mini("TP1", tp1)} \${mini("TP2", tp2)}
            \${mini("SL", stop)}
            \${mini("CRV", crv + "<div class='led-bar'>" + createLEDs(crvLED) + "</div>")}
            \${mini("RSI", Math.round(rsi) + "<div class='led-bar'>" + createLEDs(rsiLED) + "</div>")}
            \${mini("1h", change1h + "%")}
            \${mini("24h", change.toFixed(2) + "%")}
          </div>
        \`;
        document.getElementById("container").appendChild(row);
      } catch (e) {
        console.error("Fehler bei " + symbol, e);
      }
    }

    watchlist.forEach(fetchData);
  </script>
</body>
</html>